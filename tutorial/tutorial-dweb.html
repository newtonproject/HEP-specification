<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DWeb Tutorial | HEP-specification</title>
    <meta name="description" content="HEP(Hyper Exchange Protocol) Specification for DApp development in Newton ecosystem">
    <meta name="generator" content="VuePress 1.3.0">
    
    
    <link rel="preload" href="/HEP-specification/assets/css/0.styles.ba461f21.css" as="style"><link rel="preload" href="/HEP-specification/assets/js/app.419242cf.js" as="script"><link rel="preload" href="/HEP-specification/assets/js/2.810d226b.js" as="script"><link rel="preload" href="/HEP-specification/assets/js/54.6884c4e5.js" as="script"><link rel="preload" href="/HEP-specification/assets/js/3.aada4df1.js" as="script"><link rel="prefetch" href="/HEP-specification/assets/js/10.07b5122b.js"><link rel="prefetch" href="/HEP-specification/assets/js/11.07ab2f5a.js"><link rel="prefetch" href="/HEP-specification/assets/js/12.ccd7c691.js"><link rel="prefetch" href="/HEP-specification/assets/js/13.590ca748.js"><link rel="prefetch" href="/HEP-specification/assets/js/14.2d893eb2.js"><link rel="prefetch" href="/HEP-specification/assets/js/15.b78077ba.js"><link rel="prefetch" href="/HEP-specification/assets/js/16.7829fee6.js"><link rel="prefetch" href="/HEP-specification/assets/js/17.0d23eaee.js"><link rel="prefetch" href="/HEP-specification/assets/js/18.fda3c910.js"><link rel="prefetch" href="/HEP-specification/assets/js/19.388dc885.js"><link rel="prefetch" href="/HEP-specification/assets/js/20.bd33d416.js"><link rel="prefetch" href="/HEP-specification/assets/js/21.fec79911.js"><link rel="prefetch" href="/HEP-specification/assets/js/22.4852e8c3.js"><link rel="prefetch" href="/HEP-specification/assets/js/23.02ca9ad2.js"><link rel="prefetch" href="/HEP-specification/assets/js/24.a27ecedb.js"><link rel="prefetch" href="/HEP-specification/assets/js/25.6d591597.js"><link rel="prefetch" href="/HEP-specification/assets/js/26.5b54232e.js"><link rel="prefetch" href="/HEP-specification/assets/js/27.db582809.js"><link rel="prefetch" href="/HEP-specification/assets/js/28.6fe812df.js"><link rel="prefetch" href="/HEP-specification/assets/js/29.e2c1a4a5.js"><link rel="prefetch" href="/HEP-specification/assets/js/30.c8bfc05d.js"><link rel="prefetch" href="/HEP-specification/assets/js/31.efd4bdf8.js"><link rel="prefetch" href="/HEP-specification/assets/js/32.8e817237.js"><link rel="prefetch" href="/HEP-specification/assets/js/33.5124ac4c.js"><link rel="prefetch" href="/HEP-specification/assets/js/34.425f35bd.js"><link rel="prefetch" href="/HEP-specification/assets/js/35.102079c4.js"><link rel="prefetch" href="/HEP-specification/assets/js/36.476ac90a.js"><link rel="prefetch" href="/HEP-specification/assets/js/37.04ff4ab5.js"><link rel="prefetch" href="/HEP-specification/assets/js/38.7da043dd.js"><link rel="prefetch" href="/HEP-specification/assets/js/39.b6051c5a.js"><link rel="prefetch" href="/HEP-specification/assets/js/4.65a1a4c3.js"><link rel="prefetch" href="/HEP-specification/assets/js/40.0f513e54.js"><link rel="prefetch" href="/HEP-specification/assets/js/41.d680db47.js"><link rel="prefetch" href="/HEP-specification/assets/js/42.5bf0e2d1.js"><link rel="prefetch" href="/HEP-specification/assets/js/43.1d061f75.js"><link rel="prefetch" href="/HEP-specification/assets/js/44.f794bd6d.js"><link rel="prefetch" href="/HEP-specification/assets/js/45.c060c4a9.js"><link rel="prefetch" href="/HEP-specification/assets/js/46.60bf6604.js"><link rel="prefetch" href="/HEP-specification/assets/js/47.88292d12.js"><link rel="prefetch" href="/HEP-specification/assets/js/48.f9953027.js"><link rel="prefetch" href="/HEP-specification/assets/js/49.79770fab.js"><link rel="prefetch" href="/HEP-specification/assets/js/5.11a4bfaf.js"><link rel="prefetch" href="/HEP-specification/assets/js/50.c47ea8c2.js"><link rel="prefetch" href="/HEP-specification/assets/js/51.f7c689e5.js"><link rel="prefetch" href="/HEP-specification/assets/js/52.081ff357.js"><link rel="prefetch" href="/HEP-specification/assets/js/53.e66884bb.js"><link rel="prefetch" href="/HEP-specification/assets/js/55.e1ad1900.js"><link rel="prefetch" href="/HEP-specification/assets/js/56.0bb83b11.js"><link rel="prefetch" href="/HEP-specification/assets/js/57.f85086c4.js"><link rel="prefetch" href="/HEP-specification/assets/js/58.2d1f834a.js"><link rel="prefetch" href="/HEP-specification/assets/js/59.18855501.js"><link rel="prefetch" href="/HEP-specification/assets/js/6.ee814126.js"><link rel="prefetch" href="/HEP-specification/assets/js/7.cfd8f4f1.js"><link rel="prefetch" href="/HEP-specification/assets/js/8.01bf51c2.js"><link rel="prefetch" href="/HEP-specification/assets/js/9.849c036f.js">
    <link rel="stylesheet" href="/HEP-specification/assets/css/0.styles.ba461f21.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/HEP-specification/" class="home-link router-link-active"><!----> <span class="site-name">HEP-specification</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/HEP-specification/" class="nav-link">
  home
</a></div><div class="nav-item"><a href="/HEP-specification/hep-node/" class="nav-link">
  hep-node
</a></div><div class="nav-item"><a href="/HEP-specification/oracle/oracle.html" class="nav-link">
  oracle
</a></div><div class="nav-item"><a href="https://github.com/newtonproject/HEP-specification" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/HEP-specification/" class="nav-link">
  home
</a></div><div class="nav-item"><a href="/HEP-specification/hep-node/" class="nav-link">
  hep-node
</a></div><div class="nav-item"><a href="/HEP-specification/oracle/oracle.html" class="nav-link">
  oracle
</a></div><div class="nav-item"><a href="https://github.com/newtonproject/HEP-specification" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/HEP-specification/" class="sidebar-link">home</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/HEP-specification/#hep-ecosystem" class="sidebar-link">HEP Ecosystem</a></li><li class="sidebar-sub-header"><a href="/HEP-specification/#architecture" class="sidebar-link">Architecture</a></li><li class="sidebar-sub-header"><a href="/HEP-specification/#building-your-dapp" class="sidebar-link">Building your Dapp</a></li></ul></li><li><a href="/HEP-specification/oracle/oracle.html" class="sidebar-link">oracle</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/HEP-specification/oracle/oracle.html#why" class="sidebar-link">Why?</a></li><li class="sidebar-sub-header"><a href="/HEP-specification/oracle/oracle.html#how" class="sidebar-link">How?</a></li></ul></li><li><a href="/HEP-specification/DWeb.html" class="sidebar-link">DWeb</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/HEP-specification/DWeb.html#user-account-creation-and-login" class="sidebar-link">User Account Creation and Login</a></li><li class="sidebar-sub-header"><a href="/HEP-specification/DWeb.html#payments" class="sidebar-link">Payments</a></li><li class="sidebar-sub-header"><a href="/HEP-specification/DWeb.html#placeorder" class="sidebar-link">PlaceOrder</a></li></ul></li><li><a href="/HEP-specification/tutorial/" class="sidebar-link">Tutorial</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="dweb-tutorial"><a href="#dweb-tutorial" class="header-anchor">#</a> DWeb Tutorial</h1> <p>HEP provides Python、PHP、Java SDK.</p> <h2 id="sdk-installation"><a href="#sdk-installation" class="header-anchor">#</a> SDK Installation</h2> <h3 id="python-sdk"><a href="#python-sdk" class="header-anchor">#</a> python SDK</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>pip <span class="token function">install</span> hep-rest-api
</code></pre></div><h3 id="php"><a href="#php" class="header-anchor">#</a> PHP</h3> <p><a href="/HEP-specification/tutorial/tutorial\tutorial-dweb-zh-php.html">PHP Tutorial</a></p> <h3 id="java"><a href="#java" class="header-anchor">#</a> Java</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>TBD
</code></pre></div><h2 id="steps"><a href="#steps" class="header-anchor">#</a> Steps</h2> <h3 id="generating-public-private-key-pair"><a href="#generating-public-private-key-pair" class="header-anchor">#</a> Generating Public-Private Key Pair</h3> <h3 id="create-dapp"><a href="#create-dapp" class="header-anchor">#</a> Create DApp</h3> <p>TBD</p> <h3 id="basic-parameters"><a href="#basic-parameters" class="header-anchor">#</a> Basic Parameters</h3> <ul><li>Python</li></ul> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> sys

<span class="token comment"># Basic Parameters</span>
HEP_HOST <span class="token operator">=</span> <span class="token string">&quot;https://hep.testnet.newtonproject.org&quot;</span> <span class="token comment"># testnet url</span>
DAPP_ID <span class="token operator">=</span> <span class="token string">&quot;{dapp_id}&quot;</span>
DAPP_KEY <span class="token operator">=</span> <span class="token string">&quot;{dapp_key}&quot;</span>
DAPP_SECERT <span class="token operator">=</span> <span class="token string">&quot;{dapp_secret}&quot;</span>
DAPP_PRIVATE_KEY_PATH <span class="token operator">=</span> <span class="token string">&quot;{dapp_private_key_path}&quot;</span>
DAPP_PROTOCOL <span class="token operator">=</span> <span class="token string">&quot;HEP&quot;</span>
DAPP_PROTOCOL_VERSION <span class="token operator">=</span> <span class="token string">&quot;1.0&quot;</span>
CHAIN_ID <span class="token operator">=</span> <span class="token number">1012</span>  <span class="token comment"># dev environment is 1002, test environment is 1002, mainnet environment is 1012</span>

<span class="token comment"># ACTION Parameters</span>
ACTION_LOGIN <span class="token operator">=</span> <span class="token string">&quot;hep.auth.login&quot;</span>
ACTION_PAY <span class="token operator">=</span> <span class="token string">&quot;hep.pay.order&quot;</span>
ACTION_PROOF_SUBMIT <span class="token operator">=</span> <span class="token string">&quot;hep.proof.submit&quot;</span>

<span class="token comment"># Basic Config Info</span>
base_parameters <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'dapp_key'</span><span class="token punctuation">:</span> DAPP_KEY<span class="token punctuation">,</span>
    <span class="token string">'protocol'</span><span class="token punctuation">:</span> DAPP_PROTOCOL<span class="token punctuation">,</span>
    <span class="token string">'version'</span><span class="token punctuation">:</span> DAPP_PROTOCOL_VERSION<span class="token punctuation">,</span>
    <span class="token string">'os'</span><span class="token punctuation">:</span> sys<span class="token punctuation">.</span>platform<span class="token punctuation">,</span>
    <span class="token string">'language'</span><span class="token punctuation">:</span> <span class="token string">'en'</span> <span class="token comment"># Your language</span>
<span class="token punctuation">}</span>

<span class="token comment">## Create API client</span>
configuration <span class="token operator">=</span> hep_rest_api<span class="token punctuation">.</span>api_client<span class="token punctuation">.</span>Configuration<span class="token punctuation">(</span><span class="token punctuation">)</span>
configuration<span class="token punctuation">.</span>host <span class="token operator">=</span> HEP_HOST
api_client <span class="token operator">=</span> hep_rest_api<span class="token punctuation">.</span>RestApi<span class="token punctuation">(</span>hep_rest_api<span class="token punctuation">.</span>ApiClient<span class="token punctuation">(</span>configuration<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>javascript defination</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>newtonproject<span class="token operator">/</span><span class="token constant">HEP</span><span class="token operator">-</span>specification<span class="token operator">/</span>blob<span class="token operator">/</span>master<span class="token operator">/</span>hep<span class="token operator">-</span>provider<span class="token operator">/</span>user<span class="token operator">-</span>agent<span class="token punctuation">.</span>md
</code></pre></div><h3 id="newid-authorization"><a href="#newid-authorization" class="header-anchor">#</a> NewID Authorization</h3> <h4 id="initialize-authorization-helper"><a href="#initialize-authorization-helper" class="header-anchor">#</a> Initialize Authorization Helper</h4> <ul><li>python</li></ul> <div class="language-python extra-class"><pre class="language-python"><code>auth_helper <span class="token operator">=</span> AuthHelper<span class="token punctuation">(</span>_get_api_client<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> base_parameters<span class="token punctuation">,</span> DAPP_ID<span class="token punctuation">,</span> DAPP_SECERT<span class="token punctuation">,</span> DAPP_PRIVATE_KEY_PATH<span class="token punctuation">,</span> chain_id<span class="token operator">=</span>CHAIN_ID<span class="token punctuation">)</span>
</code></pre></div><h4 id="generate-authorization-signature"><a href="#generate-authorization-signature" class="header-anchor">#</a> Generate Authorization Signature</h4> <ul><li>python</li></ul> <div class="language-python extra-class"><pre class="language-python"><code>session_id <span class="token operator">=</span> <span class="token string">'{session_id}'</span><span class="token punctuation">:</span> <span class="token comment"># session identifier</span>
auth_response <span class="token operator">=</span> auth_helper<span class="token punctuation">.</span>generate_auth_request<span class="token punctuation">(</span>uuid<span class="token operator">=</span>session_id<span class="token punctuation">)</span>
</code></pre></div><h4 id="website-generate-qrcode"><a href="#website-generate-qrcode" class="header-anchor">#</a> Website Generate QRCode</h4> <ul><li>python</li></ul> <div class="language-python extra-class"><pre class="language-python"><code>qr_code_str <span class="token operator">=</span> auth_helper<span class="token punctuation">.</span>generate_qrcode_string<span class="token punctuation">(</span>auth_response<span class="token punctuation">.</span>auth_hash<span class="token punctuation">)</span>
</code></pre></div><h4 id="mobile-webistes-calls-in-build-javascript-function，callback-data-format"><a href="#mobile-webistes-calls-in-build-javascript-function，callback-data-format" class="header-anchor">#</a> Mobile webistes calls in-build Javascript function，<a href="https://github.com/newtonproject/HEP-specification/blob/master/interact-specification/DWeb-callback-error-messages.md#example">Callback Data Format</a></h4> <ul><li>Acquire login parameters，pass them to NewPay and get profile information back</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">h5login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">&quot;/request/login/h5/&quot;</span><span class="token punctuation">;</span>
    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        url<span class="token operator">:</span> url<span class="token punctuation">,</span>
        async<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>error_code <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> params <span class="token operator">=</span> res<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>hep<span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">// Make sure the object is already initialized which is injected by NewPay</span>
                    hep<span class="token punctuation">.</span>auth<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status_code <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword">var</span> profile <span class="token operator">=</span> response<span class="token punctuation">.</span>result<span class="token punctuation">;</span>   <span class="token comment">// Success return</span>
                            <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">&quot;/post/profile/&quot;</span><span class="token punctuation">;</span>
                            $<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> profile<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>error_code <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                    window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">&quot;/user&quot;</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">)</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                            <span class="token function">alert</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Failure information</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;hep is not inject&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="authorize-with-newpay-and-send-the-authorization-data-back-to-website-callback-interface"><a href="#authorize-with-newpay-and-send-the-authorization-data-back-to-website-callback-interface" class="header-anchor">#</a> Authorize with NewPay and send the authorization data back to website callback interface</h4> <p>Check callback parameter format in: https://github.com/newtonproject/HEP-specification/blob/master/interact-specification/DWeb-NewPay.md#newpay-return-to-dweb-app-or-server</p> <h4 id="website-verify-the-authorization-data"><a href="#website-verify-the-authorization-data" class="header-anchor">#</a> Website verify the authorization data</h4> <ul><li>python</li></ul> <div class="language-python extra-class"><pre class="language-python"><code>
<span class="token comment"># If return is true, then users' info is verified</span>
verify_status <span class="token operator">=</span> auth_helper<span class="token punctuation">.</span>validate_auth_callback<span class="token punctuation">(</span>data<span class="token punctuation">)</span>


<span class="token keyword">from</span> hep_rest_api<span class="token punctuation">.</span>scenarios<span class="token punctuation">.</span>auth <span class="token keyword">import</span> AuthHelper
<span class="token keyword">from</span> hep_rest_api<span class="token punctuation">.</span>scenarios<span class="token punctuation">.</span>pay <span class="token keyword">import</span> PayHelper
<span class="token keyword">from</span> hep_rest_api<span class="token punctuation">.</span>scenarios<span class="token punctuation">.</span>proof <span class="token keyword">import</span> ProofHelper
</code></pre></div><h4 id="it-s-a-success-if-http-code-is-200，otherwise-it-s-a-failure"><a href="#it-s-a-success-if-http-code-is-200，otherwise-it-s-a-failure" class="header-anchor">#</a> It's a success if http code is 200，otherwise it's a failure.</h4> <h2 id="payment"><a href="#payment" class="header-anchor">#</a> Payment</h2> <h4 id="acquire-payhelper"><a href="#acquire-payhelper" class="header-anchor">#</a> Acquire PayHelper</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">_get_pay_helper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> pay_helper<span class="token punctuation">:</span>
        <span class="token keyword">return</span> pay_helper
    <span class="token keyword">return</span> PayHelper<span class="token punctuation">(</span>_get_api_client<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> base_parameters<span class="token punctuation">,</span> DAPP_ID<span class="token punctuation">,</span> DAPP_SECERT<span class="token punctuation">,</span> DAPP_PRIVATE_KEY_PATH<span class="token punctuation">,</span> chain_id<span class="token operator">=</span>CHAIN_ID<span class="token punctuation">)</span>
</code></pre></div><h4 id="generate-payment-signature"><a href="#generate-payment-signature" class="header-anchor">#</a> Generate Payment Signature</h4> <ul><li>python</li></ul> <div class="language-python extra-class"><pre class="language-python"><code>data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'orderInformation'</span><span class="token punctuation">}</span>
pay_response <span class="token operator">=</span> pay_helper<span class="token punctuation">.</span>generate_pay_request<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
</code></pre></div><h4 id="website-generate-qrcode-2"><a href="#website-generate-qrcode-2" class="header-anchor">#</a> Website Generate QRCode</h4> <ul><li>python</li></ul> <div class="language-python extra-class"><pre class="language-python"><code>qr_code_str <span class="token operator">=</span> pay_helper<span class="token punctuation">.</span>generate_qrcode_string<span class="token punctuation">(</span>pay_helper<span class="token punctuation">.</span>pay_hash<span class="token punctuation">)</span>
</code></pre></div><h4 id="mobile-webistes-calls-in-build-javascript-function"><a href="#mobile-webistes-calls-in-build-javascript-function" class="header-anchor">#</a> Mobile webistes calls in-build Javascript function</h4> <ul><li>Acquire payment parameters，send them to NewPay and get payment result information.</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">h5pay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">&quot;/request/pay/h5/&quot;</span><span class="token punctuation">;</span>
    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        url<span class="token operator">:</span> url<span class="token punctuation">,</span>
        async<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">'order_number'</span><span class="token operator">:</span> <span class="token string">'orderNumber'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>error_code <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>hep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">let</span> params <span class="token operator">=</span> res<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
                    hep<span class="token punctuation">.</span>pay<span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status_code <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword">var</span> pay_info <span class="token operator">=</span> response<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
                            <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">&quot;/receive/pay/&quot;</span><span class="token punctuation">;</span>
                            $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                                url<span class="token operator">:</span> url<span class="token punctuation">,</span>
                                async<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                                type<span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
                                data<span class="token operator">:</span> pay_info<span class="token punctuation">,</span>
                                <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                    <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>error_code <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                        window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">&quot;/placeorder/&quot;</span>
                                    <span class="token punctuation">}</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                            <span class="token function">alert</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;hep is not inject&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="use-newpay-to-finish-the-payment-and-send-payment-data-to-website-callback-interface"><a href="#use-newpay-to-finish-the-payment-and-send-payment-data-to-website-callback-interface" class="header-anchor">#</a> Use NewPay to finish the payment and send payment data to website callback interface</h4> <p>Check callback parameters format in: https://github.com/newtonproject/HEP-specification/blob/master/interact-specification/DWeb-NewPay.md#return-transaction-information-to-dapp-js-or-server</p> <h4 id="website-verifys-payment-data-sent-from-users"><a href="#website-verifys-payment-data-sent-from-users" class="header-anchor">#</a> Website verifys payment data sent from users</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">verify_pay</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Check the signature</span>
    is_valid <span class="token operator">=</span> _get_pay_helper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>validate_pay_callback<span class="token punctuation">(</span>params<span class="token punctuation">)</span>
    <span class="token keyword">if</span> is_valid<span class="token punctuation">:</span>
        <span class="token comment"># Based on txid to acquire order information. The return includes order uuid, from address, to address, amount and so on.</span>
        response <span class="token operator">=</span> _get_pay_helper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_confirmed_transaction<span class="token punctuation">(</span>params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'txid'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># See details in: https://github.com/newtonproject/HEP-specification/blob/master/hep-protocol/README.md#return-transaction-information-to-dapp</span>
        <span class="token keyword">return</span> response
    <span class="token keyword">return</span> <span class="token boolean">None</span>
</code></pre></div><h4 id="it-s-a-success-if-http-code-is-200，otherwise-it-s-a-failure-2"><a href="#it-s-a-success-if-http-code-is-200，otherwise-it-s-a-failure-2" class="header-anchor">#</a> It's a success if http code is 200，otherwise it's a failure.</h4> <h2 id="submit-proof"><a href="#submit-proof" class="header-anchor">#</a> Submit Proof</h2> <h4 id="acquire-proofhelper"><a href="#acquire-proofhelper" class="header-anchor">#</a> Acquire ProofHelper</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">_get_proof_helper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> proof_helper<span class="token punctuation">:</span>
        <span class="token keyword">return</span> proof_helper
    <span class="token keyword">return</span> ProofHelper<span class="token punctuation">(</span>_get_api_client<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> base_parameters<span class="token punctuation">,</span> DAPP_ID<span class="token punctuation">,</span> DAPP_SECERT<span class="token punctuation">,</span> DAPP_PRIVATE_KEY_PATH<span class="token punctuation">,</span> chain_id<span class="token operator">=</span>CHAIN_ID<span class="token punctuation">)</span>
</code></pre></div><h4 id="generate-proof-submit-signature"><a href="#generate-proof-submit-signature" class="header-anchor">#</a> Generate Proof submit Signature</h4> <ul><li>python</li></ul> <div class="language-python extra-class"><pre class="language-python"><code>content <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'proofinformation'</span><span class="token punctuation">}</span>
uuid <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'session_id'</span><span class="token punctuation">}</span>
proof_response <span class="token operator">=</span> proof_helper<span class="token punctuation">.</span>generate_proof_request<span class="token punctuation">(</span>content<span class="token punctuation">.</span>to_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> uuid<span class="token punctuation">)</span>
</code></pre></div><h4 id="website-generate-qrcode-3"><a href="#website-generate-qrcode-3" class="header-anchor">#</a> Website Generate QRCode</h4> <ul><li>python</li></ul> <div class="language-python extra-class"><pre class="language-python"><code>qr_code_str <span class="token operator">=</span> proof_helper<span class="token punctuation">.</span>generate_qrcode_string<span class="token punctuation">(</span>proof_response<span class="token punctuation">.</span>proof_hash<span class="token punctuation">)</span>
</code></pre></div><h4 id="mobile-webistes-calls-in-build-javascript-function-2"><a href="#mobile-webistes-calls-in-build-javascript-function-2" class="header-anchor">#</a> Mobile webistes calls in-build Javascript function</h4> <ul><li>Acquire proof parameters and them to NewPay</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">h5proof</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">&quot;/request/proof/h5/&quot;</span><span class="token punctuation">;</span>
    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        url<span class="token operator">:</span> url<span class="token punctuation">,</span>
        async<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">'order_number'</span><span class="token operator">:</span> <span class="token string">'orderNumber'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>error_code <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>hep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">let</span> params <span class="token operator">=</span> res<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
                    hep<span class="token punctuation">.</span>proof<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status_code <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword">var</span> proof_info <span class="token operator">=</span> response<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
                            <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">&quot;/receive/proof/&quot;</span><span class="token punctuation">;</span>
                            $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                                url<span class="token operator">:</span> url<span class="token punctuation">,</span>
                                async<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                                type<span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
                                data<span class="token operator">:</span> proof_info<span class="token punctuation">,</span>
                                <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#tip'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                            <span class="token function">alert</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> 
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;hep is not inject&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="submit-proof-by-newpay-and-send-the-data-to-website-callback-interface"><a href="#submit-proof-by-newpay-and-send-the-data-to-website-callback-interface" class="header-anchor">#</a> Submit proof by NewPay and send the data to website callback interface</h4> <p>Check callback data format in: https://github.com/newtonproject/HEP-specification/blob/master/interact-specification/DWeb-NewPay.md#result-to-dweb-app-or-server</p> <h4 id="website-verify-proof-data-sent-from-users"><a href="#website-verify-proof-data-sent-from-users" class="header-anchor">#</a> Website verify proof data sent from users</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">verify_proof</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Verify proof signature</span>
    is_valid <span class="token operator">=</span> _get_proof_helper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>validate_proof_callback<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">if</span> is_valid<span class="token punctuation">:</span>
        <span class="token comment"># Can do batch verification of the status of proof_hash</span>
        proof_hashes <span class="token operator">=</span> <span class="token punctuation">[</span>data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'proof_hash'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        response <span class="token operator">=</span> _get_proof_helper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_status_of_proofs<span class="token punctuation">(</span>proof_hashes<span class="token punctuation">)</span>
        <span class="token comment"># If only one proof is required to verify, take the first item in the array. The returns include proof_hash and proof_status</span>
        <span class="token comment"># proof_status data type: string. SUBMIT(submitted), CONFIRMED(on blockchain), CANCELED(canceled), PART_CANCELED(partly canceled/refund)</span>
        <span class="token comment"># See details in https://github.com/newtonproject/HEP-specification/blob/master/hep-node/REST-API.md#proof_getproofreceipts</span>
        <span class="token keyword">return</span> response<span class="token punctuation">.</span>receipts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> <span class="token boolean">None</span>
</code></pre></div><h4 id="it-s-a-success-if-http-code-is-200，otherwise-it-s-a-failure-3"><a href="#it-s-a-success-if-http-code-is-200，otherwise-it-s-a-failure-3" class="header-anchor">#</a> It's a success if http code is 200，otherwise it's a failure.</h4></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/HEP-specification/assets/js/app.419242cf.js" defer></script><script src="/HEP-specification/assets/js/2.810d226b.js" defer></script><script src="/HEP-specification/assets/js/54.6884c4e5.js" defer></script><script src="/HEP-specification/assets/js/3.aada4df1.js" defer></script>
  </body>
</html>
